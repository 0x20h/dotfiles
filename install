#!/bin/sh
info() { echo "\033[1;32m$1\033[0m"; }
title() { echo "\033[1;34m$1\033[0m"; }
warn() { echo "\033[1;31m$1\033[0m"; }

BASE=$(readlink -f $(dirname $0))
cd $BASE

if [ ! -d ~/bin ]; then
	mkdir ~/bin
fi

if [ ! -d $BASE/git ]; then
	mkdir $BASE/git
fi

dependencies() {
	local deps=""
	title "Fetching dependencies"
	title "---------------------"
	for s in install.d/*; do
		. $s
		for r in $(depends); do
			deps="$deps $r"
		done;
	done

	deps=$(echo $deps | tr " " "\n" | sort | uniq | xargs)
	title "Collected: '$deps', installing..."
	sudo apt-get install $deps
}

dependencies

for s in install.d/*; do
	. $s
	install
	cd $BASE
done

# copy dotfiles
for i in $(ls dotfiles); do
	rm -rf ~/.$i
	cp -r dotfiles/$i ~/.$i
done

if [ -f private-vimrc ]; then
	# append private settings, place a private-vimrc in this directory
	cat private-vimrc >> ~/.vimrc
fi

cp bin/* ~/bin

grep -q ".bash_custom" ~/.bashrc

if [ $? -ne 0 ]; then
	info "adding bash_custom entry to your .bashrc"
	echo "if [ -f ~/.bash_custom ]; then . ~/.bash_custom; fi" >> ~/.bashrc
fi

